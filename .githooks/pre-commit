#!/usr/bin/env bash

echo "ğŸ”’ pre-commit ãƒ•ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
echo "ğŸ“‹ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯..."
bun run scripts/security-check.ts --staged
if [ $? -ne 0 ]; then
  echo "âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ"
  exit 1
fi

# Biomeãƒã‚§ãƒƒã‚¯ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
echo "ğŸ“‹ ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|jsx|ts|tsx|json|astro|mjs|cjs)$' | tr '\n' ' ')

if [ -n "$STAGED_FILES" ]; then
  # ã‚¨ãƒ©ãƒ¼ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã¯ç„¡è¦–ï¼‰
  bun run check:errors-only
  if [ $? -ne 0 ]; then
    echo "âŒ ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ"
    echo "ğŸ’¡ 'bun run check' ã§è‡ªå‹•ä¿®æ­£ã§ãã¾ã™"
    exit 1
  fi
fi

echo "âœ… pre-commit ãƒã‚§ãƒƒã‚¯å®Œäº†ï¼"